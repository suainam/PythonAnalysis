# 数据库系统（新技术）

## 数据库技术发展回顾

### 三个方面

+ 数据模型：数据对象越来越多，越来越丰富
	+ 第一代，层次网状
	+ 第二代，关系模型
	+ nosql、newsql等模型
+ 相关技术，其他计算机技术
	+ 分布式数据库
	+ 并行数据库系统
	+ 知识、多媒体、模糊、移动、web等数据库
+ 应用领域
	+ 联机事务处理
	+ OLAP
	+ 数据挖掘、地理信息系统、科学实验等

### 4位图灵奖得主

+ 第1代数据库系统，层次和网状数据库系统
	+ 1969年，IMS，IBM的层次模型数据库管理系统
	+ 20世界60年代末到70年代初，数据库任务组的**DBTG报告**，基于网状结构，但提出的概念方法和技术是普遍适用的
	+ IDS：通用电气公司开发了第一个数据可独立存在、多个应用可同时共享访问的数据库产品。推动与促成了DBTG报告，**提出数据库系统三级模式结构，确定了数据库系统的基本结构**。
	+ Bachman于1973年获得图灵奖
	+ 启示：
		+ 数据独立性：让数据与应用有一定距离（数据与应用分离，数据独立性），可以增加DBMS系统的适应性和应用系统的稳定型。
		+ “模式”在三级模式结构（内模式、模式、外模式）中扮演者中心的角色，是应用系统与数据库系统“交流”的桥梁
		+ 体现了数据的语义关系
+ 第2代数据库系统
	+ 1970年，E.F.Codd发表《大型共享数据库数据的关系模型》，为关系数据库技术奠定了理论基础
	+ 典型代表
		+ IBM开发的System R
		+ Berkeley大学研制的INGRES
	+ 20世纪70年代的代表性成就
		+ 关系数据模型的提出，理论和数据库语言，数据库的研制和广泛应用
		+ 关系数据库的优点
			+ 简单的数学模型
			+ SQL非过程化的标准语言
			+ 查询优化技术
			+ 事务管理技术
	+ 关系数据库之父，Edgar F.Codd，1981年获得图灵奖
	+ 启示：
		+ 关系模型
		+ 非过程化语言：提高应用系统开发的生产率
		+ 系统性能：可以通过技术的不断进步来改善
		+ 查询优化技术成为系统研究与开发的永恒的主题
+ 20世纪80年代的代表性成果
	+ 事物处理理论（ACID）与实现技术使得关系数据库走向极致
	+ 保证数据库的完整性和一致性是DBMS的最基本要求
	+ 在数据库和事务处理研究方面的原创性共享以及在将研究原型转化为商业产品的系统实现方面的技术领袖地位，Jim Gray，1998年获得图灵奖
	+ 启示：
		+ 关系数据库不仅仅是一个产品，而且形成了一个生态
		+ 产品
		+ 标准
		+ 评测
		+ 工具
+ 21世纪初的代表性成果：新一代数据库系统架构的研究与开发
	+ 1971~2000，第1阶段，关系数据库的体系架构与实现技术研究
	+ 2001~2008，第2阶段，提出"one-size does not fit all"，针对不同应用设计开发了一系列新型数据库系统的体系架构
		+ 流数据库Auraro
		+ 列存储数据仓库C-store
		+ 高性能OLAP系统H-store
		+ 科学数据库SciDB等
	+ 2009~至今，第3阶段，大数据系统的体系及增资设计与实践
	+ 现在主流数据库系统架构的奠基人，Michael Stonebraker，2014年获得图灵奖
	+ 启示：
		+ one-size does not fit all
		+ 按照应用需求与系统功能分，可以有各种不同类型的系统
			+ OLTP（oracle）
			+ OLAP（teradata)
			+ search(hadoop)
			+ 大数据丰富多彩的应用
		+ **传统的数据库核心技术是大数据管理与处理技术的基础**
		+ 大数据不等于，也不能取代传统的数据库技术
		+ 大数据与其他数据处理技术相结合，通过细分的技术和市场，满足用户不同层面的需求

### 当前数据管理与应用面临的挑战

+ 数据的变化
	+ 数据量越来越大，可扩展性和伸缩性
	+ 数据类型越来越多样和异构，非结构化、半结构化等
+ 应用和需求的变化
	+ 数据处理和应用领域的发展
		+ 深度、广度
		+ OLTP->OLAP->Search
		+ 对非结构化数据的复杂分析和深度挖掘
	+ 大数据分析与挖掘成为大数据应用中的关键
		+ 海量异构、形式复杂、高速增长、价值密度低等阻碍了数据价值的创造。
		+ 现有分析挖掘算法：
			+ 缺乏可扩展性
			+ 缺乏对复杂异构数据的高效分析算法
			+ 缺乏大规模知识库的支持和应用
			+ 缺乏能被非技术领域专家理解的分析结果表达方法
		+ **对数据的组织、管理、检索和分析都是基础性的挑战**
+ 相关技术的发展
	+ 计算机赢家体系结构的发展
	+ 以集群为特征的云存储成为大型应用的价格
		+ 数据处理平台由单处理器平台向多喝、大内存，集群，云计算平台转移
	+ **大数据给数据管理、数据处理和数据分析提出了全面挑战**

## 数据库新技术篇

### 传统数据库技术的创新与发展

+ 数据仓库与OLAP关键技术
+ 数据挖掘
+ 内存数据库
+ 数据库一体机
+ 数据库安全性新技术
+ 开元数据库系统

### 大数据管理技术和系统的研究与开发

+ 大数据技术概论
	+ 数据特征
	+ 系统特征
	+ 应用特征
+ 大数据平台
	+ 大数据处理平台及生态系统
	+ SQL on Hadoop Systems
	+ NoSQL数据库
		+ k-v系统, bittable, hbase
		+ 文档数据库，mongodb
		+ 图数据库，neo4j
	+ 流数据分析与处理
+ 大数据算法与分析
	+ 大数据近似算法
	+ 大数据与机器学习
	+ 社交网络大数据分析
	+ 文本大数据分析及应用案例
	+ 多媒体大数据分析
+ 参考教材
	+ 数据库系统概论（第5版），王珊，高等教育出版社
	+ 数据仓库与数据分析教程，王珊，高等教育出版社
	+ 内存数据库技术与实现，张延松，王珊，高等教育出版社

## 内存数据库

### 定义

+ 概念：使用内存作为常规数据存储设备的数据库系统
+ 特点
	+ 内存为主要存储设备
	+ 磁盘为后备存储和持久化设备
	+ 面向内存访问而非I/O的优化 
+ 磁盘的缓冲区与内存数据库的差异
	+ 存储方面：磁盘数据库的缓冲区是磁盘数据在内存的副本，采用与磁盘存储一致的基于page-slot的数据结构。磁盘数据库在磁盘为page为单位存储数据，一个I/O访问一个数据page（4kb或8kb）；内存数据库的存储，在内存储按照行或列存储，数据访问的单位为cache line（64字节）。比磁盘数据库的存储和访问粒度更细。访问算法以内存访问特性为基础，实现处理器对数据的直接访问，在算法和代码效率上高于以I/O为基础的磁盘数据库

	+ 索引和查询处理方面：磁盘数据库的B+数优化技术，节点大小与page一致，内部节点多指针减少I/O访问代价，内存数据库中，使用针对内存访问特性进行优化的T树索引和hash索引、面向cache优化的索引算法和多种面向连接操作的优化技术，进一步优化了内存数据库的性能

+ 磁盘数据库的缓冲区足够大，可容纳全部磁盘数据，数据访问知识相当于在内存磁盘（RAM Disk）上的访问，但是性能依然比不上内存数据库	

### 新硬件技术推动内存数据库发展

+ 两个驱动因素
	+ 存储技术
	+ 处理器技术
+ 存储技术
	+ 新的技术挑战
		+ 多级存储层次：存在巨大的访问延迟差异
			+ l1 cach 1s；l2, 3s; l3, 10s; 内存, 1.5m
		+ 存储技术发展趋势
			+ 各级存储性能不断提升，但各级存储访问延迟性能差距仍然较大
			+ Memory is new disk（相对于CPU仍然较慢）
	+ 非易失存储器（Non-Volatile Memory，NVM）
		+ 改变存储层次设计
			+ 未来3D Xpoint非易失性内存可能会逐渐取代DRAM成为持久化热数据存储层
			+ 新型非易失性内存存储密度更大，成本更低，支持更高性价比的内存计算应用
			+ 新型存储简化存储层次，推动数据库存储引擎升级	
+ 协处理技术
	+ 处理器技术进步推动内存数据库发展
		+ 处理器从多核走向众核，从同构走向异构
		+ 查询优化技术从以cache为中心走向以高并行计算为中心
+ 小结
	+ 内存数据库技术**依赖**于硬件技术发展
		+ 高性能处理器、大内存支持内存数据库应用
	+ 内存数据库需要**克服**硬件技术障碍
		+ 内存墙：通过面向缓存的优化技术克服内存访问瓶颈
	+ 内存数据库通过硬件敏感技术**优化**性能
		+ 优化多级cache访问性能：cache-conscious设计的存储模型、索引结构、数据访问及查询执行
		+ 优化SIMD性能：面向SIMD的排序、链接、谓词处理等优化算法
	+ 新硬件技术进一步**推动**内存数据库发展
		+ 非易失性内存NVM：简化内存数据库日志机制，优化持久性数据存储性能
		+ 众核协处理器：提高内存数据库并行处理能力，分担CPU计算负载，加速计算性能
		+ 新型处理器：物理融合架构支持内存数据库双查询处理引擎设计

### 内存数据库技术示例

+ 内存数据库
	+ MonetDB，列存储
		+ 列存储、列压缩、列即是索引、cache性能更高的列访问
		+ 面向SIMD（单指令多数据）的向量计算简单BAT结构，简单计算模型
		+ 向量处理技术优化cache数据访问
			+ 目标：减少中间结果的内存物化代价
			+ 方法：以适合L1 cache的较小粒度的向量作为查询处理的数据粒度，通过L1 cahce提高中间结果的额物化和访问性能
			+ 优化策略：使用向量个数越多，性能最佳时向量长度区间越窄，当向量能够完全容纳在L1 chche时查询性能最优
		+ 以适合L1 cache大小的向量作为查询处理的单位，查询处理中间结果在L1 cache中物化，减少内存访问代价，提高代码执行效率
	+ Vectorwise，向量存储
	+ 表现的差异主要取决于：不同的查询处理模型
		+ 行处理、列处理、向量处理模型查询性能
		+ row-wise：迭代处理产生的函数调用及查询解析代价高
		+ column-wise：中间结果内存物化操作的存储及处理代价高
		+ vectorized processing: 减少物化代价，分摊迭代处理代价
		+ **向量处理模型成为当前内存数据库的主流技术**
		+ 如何进一步提高数据库查询执行性能：执行代码优化
### 内存数据库